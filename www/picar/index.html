<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Jackson 2012</title>

    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link rel="stylesheet" href="../vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../vendor/simple-line-icons/css/simple-line-icons.css">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">
  
    <!-- Code formmating scripts -->
    <link rel="stylesheet" href="../css/highlight.pack.css">
    <script src="../js/highlight.pack.js"></script>
    
    <!-- Custom styles for this template -->
    <link href="../css/jackson2012.css" rel="stylesheet">
    <link href="../css/picar.css" rel="stylesheet">

    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-light fixed-top always-shrink" id="mainNav">
      <div class="container nav-container-override">
        <div>
            <a class="navbar-brand js-scroll-trigger" href="/">Jackson 2012</a><i class="bullet">&bull;</i><a class="navbar-brand js-scroll-trigger" href="#page-top">Pi Car</a>
        </div>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#zero">0- Component List</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#one">1- Install Raspian OS</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#two">2- Setup Node-Red</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#three">3- Install Mjpg-Streamer</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <header class="masthead">
      <div class="container h-100">
        <div class="row h-100">
          <div class="col-lg-7 my-auto">
            <div class="header-content mx-auto">
              <h1 class="mb-5">Raspi Car</h1>
              <p>
                This is my project to make an internet controlled car from an old RC car and a Raspberry Pi. 
                It consists of a web server running on a Raspberry Pi Zero W, a webcam and an old RC car. 
                The components may be purchased for about $45.00 making this an affordable and fun project.
                Some soldering is required so you will need a soldering iron and some jumper wires. 
              </p>
              <h4>Jump To:</h4>
              <ul>
                <li>
                    0-<a class="nav-link js-scroll-trigger" href="#zero">Components List</a>
                </li>
                <li>
                    1-<a class="nav-link js-scroll-trigger" href="#one">Install Raspian OS</a>
                </li>
                <li>
                    2-<a class="nav-link js-scroll-trigger" href="#two">Setup Node-Red</a>
                </li>
                <li>
                    3-<a class="nav-link js-scroll-trigger" href="#three">Install Mjpg-Streamer</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-5 my-auto">
            <div class="device-container">
              <div class="device">
                <div class="screen">
                  <img src="../img/pi_3.png" class="img-fluid" alt="">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section class="guide" id="zero">
      <div class="container">
        <div class="row">
          <div class="col-md-8 mx-auto">
            <h2 class="section-heading text-center">Component List</h2>
            <div class="row">
              <div class="col-md-12 mx-auto">
                <p>
                  <ul>
                    <li>
                        <u>A Raspberry Pi Zero W</u><br />
                        &emsp; A Raspberry Pi Zero W is a small single board computer made by the Raspbery Pi Foundation.
                        For more information visit <a href="https://www.raspberrypi.org/">https://www.raspberrypi.org/</a> .
                        It is perfect because of it's small size and built in Wifi. 
                        An 8GB or even a 4GB SD card for th OS is sufficient for this project.
                    </li>
                    <li>
                      <u>USB Web Cam</u><br />
                      &emsp; I recommend a Creative - Live! Cam which runs about $20.00. 
                      You may be able to find a less expensive one on ebay, just avoid shipments from China. 
                      An OTG micro USB-to-USB is needed to connect the camera to the Pi.
                    </li>
                    <li>
                        <u>RC Car</u><br />
                        &emsp; Maybe the most difficult component to get.
                        Newer cars in the stores use lipo batteries and have smaller electronics making them difficult to use.
                        Thrift stores like Salvation Army or Goodwill are the best places. 
                        The transmitter won't be needed, so buy it even if it doesn't have one.
                        Having said that, the cars there are sort of hit or miss. 
                        Often times they may not work, but for a price of 4-6 dollars a couple of duds won't break the bank. 
                        If you have bought more duds than you wanted and are feeling ambitious you could hobble together a car from working parts.
                        If you are unable to find one with a battery you will need to purchase one which will increase the cost.
                        When buying a car note the voltage required. 
                        Some cars use standard double A batteries and only run on 6 volts.
                        Those will be difficult to use.
                        The best cars will use a 9.6 volt battery.
                      </li>
                      <li>
                          <u>A USB Adapter.</u><br/>
                        &emsp; One that would be used in a car outlet.
                        This will take the voltage down from 9.6v to 5v, The operating voltage for the Raspberry Pi.
                      </li>
                      <li>
                        <u>Jumper wires</u><br />
                        &emsp;Male to female.
                      </li>
                      <li>
                        <u>Wire</u><br />
                        &emsp;26 or 24 gage;
                      </li>
                      <li>
                        <u>Tamiya Big Style Connector Plugs</u><br />
                        &emsp;Unwired.
                      </li>
                  </ul>
                <hr>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="guide" id="one">
      <div class="container">
        <div class="row">
          <div class="col-md-8 mx-auto">
            <h2 class="section-heading text-center">Install Raspian OS</h2>
            <div class="badges text-center">
              <a class="badge-link" href="https://www.raspberrypi.org/downloads/"><img src="../img/raspbian-badge.png" alt=""></a>
            </div>
            <div class="row">
              <div class="col-md-12 mx-auto">
                <p>
                  &emsp; Download Raspiban <a href="https://www.raspberrypi.org/downloads/raspbian/">here</a>.
                  Get the lite version because there will be no need for a user interface.
                  Next download Win32 Disk Imager <a href="https://sourceforge.net/projects/win32diskimager/">here</a>.
                  Run the disk imager and select the .img file and your SD Card to install the OS.
                  After that is done it is time to boot the Pi.
                  Connect it to a TV or Monitor via HDMI and a keybord then provide power.
                  After it boots login with the default user name "pi" and password "raspberry".
                  Before anything we need to get the device onto the wifi. (For a more detailed check <a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">here</a>.
                </p>

                <p>
                  To add Wifi:
                  <pre><code class="shell">  sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</code></pre>

                <p>
                  Edit the file to have these lines.
                  <pre><code class="bash">  network={
    ssid="name_of_wifi"
    psk="passkey_of_wifi"
  }</code></pre>
                </p>

                <p>
                  Press <code class="no-highlight">ctrl-X</code> to save and exit.
                </p>

                <p>
                  By default Raspbian has SSH disabled. To enable it type these lines.
                  <pre>
                    <code class="shell">  sudo systemctl enable ssh 
  sudo systemctl start ssh</code></pre>
                </p>

                <p>
                  &emsp; Reboot by typing <code class="bash">sudo reboot</code>
                  Once it has rebooted login and type <code class="bash">ifconfig</code> and note the IP address.
                  The Pi may now be disconnected from the TV/Monitor and keyboard; they are no longer needed.
                  Further interfacing with the Pi can be dome remotely with an SSH client.
                  <a href="http://www.putty.org/">Putty</a>,
                  <a href="https://winscp.net/eng/download.php">WinSCP</a>, or 
                  <a href="https://mobaxterm.mobatek.net/">MobaXterm</a> will work.
                  Select your favorite and log into the IP address from before with the default username and password.
                </p>

                <p>
                  Before we enter any commands we we want to update the Pi to the latest. Run:
                  <pre><code class="shell">  sudo apt-get update
  sudo apt-get upgrade</code></pre>
                </p>
                <hr>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="guide" id="two">
        <div class="container">
          <div class="row">
            <div class="col-md-8 mx-auto">
              <h2 class="section-heading text-center">Node Red</h2>
              <div class="badges text-center">
                <a class="badge-link" href="https://nodered.org/"><img src="../img/nodered-badge.png" alt=""></a>
              </div>
              <div class="row">
                <div class="col-md-12 mx-auto">
                  <p>
                    Node Red will hadle the web pages and controlling the GPIOs. For a detailed setup guide visit <a href="https://nodered.org/docs/hardware/raspberrypi">Node-RED : Running on Raspberry Pi</a>
                  </p>
  
                  <p>
                    To get the latest node red for Raspberry Pi run:
                    <pre><code class="shell">  bash &lt;(curl -sL https://raw.githubusercontent.com/node-red/raspbian-deb-package/master/resources/update-nodejs-and-nodered)</code></pre>
                  </p>
                  
                  <p>
                    Adjust the settings for node red by running:
                    <pre><code class="shell">  nano /home/pi/.node-red/settings.js</code></pre>
                  </p>
                  <p>
                    And change the following settings:
                  </p>
                  <p>
                    <code class-"bash:">  httpAdminRoot: </code> to <code class="bash">'/node-red/'</code>
                  </p>
                  <p>
                    <code class="bash"  >httpStatic: </code> to <code class="bash">'/home/pi/.picar/www/'</code>
                  </p>
                  <p>
                    If needed, uncomment the lines first.
                    This will set the default path of the editor to <code class="html">http://hostname:1880/node-red/</code>
                    allowing the Picar page to be visible from the root.
                    The second setting tells node-red where to look for the web page assets.
                    This becomes the root directory for any web pages served by http nodes.
                  </p>
                  <p>
                    Download the web assets here <a href="../assets/picar-nodered-www.zip">picar-nodered-www.zip</a>. 
                    Unzip and copy to <code class="no-highlight">/home/pi/.picar</code> Create the directory as needed.
                  </p>
  
                  <p>
                    To set up the flows for this project I have provided three flows to import: Auth, Control, and Driver.
                    You can access Node-Red by opening a browser to the Pi's IP address on port 1880 in the node-red directory (e.g. 
                    <code class="html">http://192.168.1.22:1880/node-red</code>).
                    Open the menu in the top left of the screen and select <code class="no-highlight">Import &gt; Clipboard</code>
                    Paste the following into a new flow.
                  </p>
  
                  <p>
                    <h3>PiCar Auth</h3>
                  </p>
  
                  <div class="btn-group btn-group-code" role="group">
                    <button id="show-picar-auth-flow-code" type="button" class="btn btn-info" data-toggle="collapse" data-target="#picar-auth-flow">Show Code</button>
                    <button id="copy-picar-auth-flow-code" type="button" class="btn btn-info">Copy Code</button>
                  </div>
  
                  <div id="picar-auth-flow" class="collapse">
                    <pre><code class="json auth-code">  [
    {
        "id": "acc22612.1a8258",
        "type": "file in",
        "z": "1fee60dc.191fff",
        "name": "auth.html",
        "filename": "/home/pi/.picar/www/auth.html",
        "format": "utf8",
        "sendError": true,
        "x": 520,
        "y": 80,
        "wires": [
            [
                "aff0c571.204548"
            ]
        ]
    },
    {
        "id": "9d08714e.9b236",
        "type": "function",
        "z": "1fee60dc.191fff",
        "name": "Get Submitted",
        "func": "var driver = msg.payload.driver.toLowerCase();\nvar key = msg.payload.key;\n\nmsg.driver = driver;\n\nvar keyObject = {};\nkeyObject[driver] = key;\n\nmsg.payload = JSON.stringify(keyObject);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 160,
        "y": 100,
        "wires": [
            [
                "32ae2dc5.59e942"
            ]
        ]
    },
    {
        "id": "ab57849c.aa3bc8",
        "type": "function",
        "z": "1fee60dc.191fff",
        "name": "Store Hash",
        "func": "msg.key = msg.payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 150,
        "y": 180,
        "wires": [
            [
                "b8ae7304.33a36"
            ]
        ]
    },
    {
        "id": "b8ae7304.33a36",
        "type": "file in",
        "z": "1fee60dc.191fff",
        "name": "keys",
        "filename": "/home/pi/.picar/www/keys",
        "format": "utf8",
        "sendError": true,
        "x": 130,
        "y": 220,
        "wires": [
            [
                "812830b9.9fe19"
            ]
        ]
    },
    {
        "id": "812830b9.9fe19",
        "type": "json",
        "z": "1fee60dc.191fff",
        "name": "",
        "x": 130,
        "y": 260,
        "wires": [
            [
                "b6755af4.76fc78"
            ]
        ]
    },
    {
        "id": "b6755af4.76fc78",
        "type": "function",
        "z": "1fee60dc.191fff",
        "name": "Validate",
        "func": "var keyRing = msg.payload;\nvar driver = msg.driver.toLowerCase();\nvar key = msg.key;\n\nif (keyRing[driver] &amp;&amp; keyRing[driver] === key) {\n    keyobject = {};\n    keyobject[driver] = key;\n    msg.cookies = {\n        carkey: {\n            value: JSON.stringify(keyobject),\n            maxAge: 10*365*24*60*60*1000\n        }\n    }\n    msg.payload = 'succeeded';\n    return msg\n}\nmsg.payload = 'failed';\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 140,
        "y": 300,
        "wires": [
            [
                "3b5b91b6.7d3a4e"
            ]
        ]
    },
    {
        "id": "3b5b91b6.7d3a4e",
        "type": "http response",
        "z": "1fee60dc.191fff",
        "name": "",
        "x": 270,
        "y": 300,
        "wires": []
    },
    {
        "id": "aff0c571.204548",
        "type": "http response",
        "z": "1fee60dc.191fff",
        "name": "",
        "x": 650,
        "y": 80,
        "wires": []
    },
    {
        "id": "d82fa1aa.d92c7",
        "type": "http in",
        "z": "1fee60dc.191fff",
        "name": "",
        "url": "/picar",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 360,
        "y": 60,
        "wires": [
            [
                "3bd7d0a7.acf3a"
            ]
        ]
    },
    {
        "id": "a6603349.42ce1",
        "type": "file in",
        "z": "1fee60dc.191fff",
        "name": "keys",
        "filename": "/home/pi/.picar/www/keys",
        "format": "utf8",
        "sendError": true,
        "x": 350,
        "y": 140,
        "wires": [
            [
                "92e3b880.587308"
            ]
        ]
    },
    {
        "id": "92e3b880.587308",
        "type": "json",
        "z": "1fee60dc.191fff",
        "name": "",
        "x": 350,
        "y": 180,
        "wires": [
            [
                "4fa6a0c2.68daa"
            ]
        ]
    },
    {
        "id": "4fa6a0c2.68daa",
        "type": "function",
        "z": "1fee60dc.191fff",
        "name": "Validate",
        "func": "var keyring = msg.payload;\nvar submitted = msg.submitted;\nvar driver = Object.keys(submitted)[0].toLowerCase();\n\nvar key = submitted[driver];\n\nif (keyring[driver] &amp;&amp; keyring[driver] === key) {\n    return [null, msg];\n}\n\nreturn [msg, null];\n",
        "outputs": "2",
        "noerr": 0,
        "x": 360,
        "y": 220,
        "wires": [
            [
                "eba92dae.3e76e"
            ],
            [
                "ea78a51.6065e58"
            ]
        ]
    },
    {
        "id": "eba92dae.3e76e",
        "type": "file in",
        "z": "1fee60dc.191fff",
        "name": "auth.html",
        "filename": "/home/pi/.picar/www/auth.html",
        "format": "utf8",
        "sendError": true,
        "x": 500,
        "y": 200,
        "wires": [
            [
                "7a0630ad.57f1d"
            ]
        ]
    },
    {
        "id": "7a0630ad.57f1d",
        "type": "http response",
        "z": "1fee60dc.191fff",
        "name": "",
        "x": 630,
        "y": 220,
        "wires": []
    },
    {
        "id": "ea78a51.6065e58",
        "type": "file in",
        "z": "1fee60dc.191fff",
        "name": "main.html",
        "filename": "/home/pi/.picar/www/main.html",
        "format": "utf8",
        "sendError": true,
        "x": 500,
        "y": 240,
        "wires": [
            [
                "7a0630ad.57f1d"
            ]
        ]
    },
    {
        "id": "2da48ba9.6645b4",
        "type": "http in",
        "z": "1fee60dc.191fff",
        "name": "",
        "url": "/picar",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "9d08714e.9b236"
            ]
        ]
    },
    {
        "id": "3bd7d0a7.acf3a",
        "type": "function",
        "z": "1fee60dc.191fff",
        "name": "Get Cookie",
        "func": "var c = msg.req.cookies;\nif (c.carkey){\n    msg.payload = c.carkey;\n    msg.submitted = JSON.parse(c.carkey);\n    return [null, msg];\n}\nreturn [msg, null]",
        "outputs": "2",
        "noerr": 0,
        "x": 370,
        "y": 100,
        "wires": [
            [
                "acc22612.1a8258"
            ],
            [
                "a6603349.42ce1"
            ]
        ]
    },
    {
        "id": "32ae2dc5.59e942",
        "type": "hmac",
        "z": "1fee60dc.191fff",
        "name": "",
        "algorithm": "HmacSHA512",
        "key": "Enter-HMAC-Key-Here",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "ab57849c.aa3bc8"
            ]
        ]
    }
    ]</code></pre>
                    </div>
                  <div class="nodered-screen">
                    <img src="../img/picar-auth-flow.png" />
                  </div>
                  <p>
                    Open the hmac node by double clicking it. Enter a secret key to encrypt passwords.
                    This key should be the same as the one in the Driver flow (more on that).
                  </p>
  
                  <p>
                    For the flow that will control the GPIOs, paste the following into a new flow.
                  </p>
  
                  <p>
                    <h3>PiCar Control</h3>
                  </p>
  
                  <div class="btn-group btn-group-code" role="group">
                    <button id="show-picar-control-flow-code" type="button" class="btn btn-info" data-toggle="collapse" data-target="#picar-control-flow">Show Code</button>
                    <button id="copy-picar-control-flow-code" type="button" class="btn btn-info">Copy Code</button>
                  </div>
  
                  <div id="picar-control-flow" class="collapse">
                    <pre><code class="json control-code">  [
    {
        "id": "54124946.bfd8e8",
        "type": "websocket in",
        "z": "8cc8cd00.37ee",
        "name": "",
        "server": "32f33346.bc3b9c",
        "client": "",
        "x": 130,
        "y": 160,
        "wires": [
            [
                "9ebd8f9d.38da"
            ]
        ]
    },
    {
        "id": "9ebd8f9d.38da",
        "type": "json",
        "z": "8cc8cd00.37ee",
        "name": "",
        "x": 290,
        "y": 160,
        "wires": [
            [
                "1bfe69cb.9c2b36"
            ]
        ]
    },
    {
        "id": "1bfe69cb.9c2b36",
        "type": "function",
        "z": "8cc8cd00.37ee",
        "name": "",
        "func": "var m = msg.payload;\n\nvar dmv = context.global.get('dmv')||{};\nvar license = m.License;\nvar now = (new Date()).getTime();\nif(dmv[license] + 300000 < now){\n    msg.payload = \"Connection Timeout\";\n    return [null, null, null, null, msg];\n}\n\nvar thrust = 'Idle';\nvar yaw = 'Straight';\n\nif(m.Forward == 1 &amp;&amp; m.Reverse == 1){\n    m.Forward = 0;\n    m.reverse = 0;\n}\nif(m.Left == 1 &amp;&amp; m.Right == 1){\n    m.Right = 0;\n    m.Left = 0;\n}\nif(m.Forward == 1){thrust = 'Forward';}\nif(m.Reverse == 1){thrust = 'Reverse';}\nif(m.Left == 1){yaw = 'Left';}\nif(m.Right == 1){yaw = 'Right';}\n\nvar text = thrust + ' ' + yaw;\n\nreturn [{payload: m.Forward},\n        {payload: m.Reverse},\n        {payload: m.Left},\n        {payload: m.Right},\n        {payload: text}];",
        "outputs": "5",
        "noerr": 0,
        "x": 410,
        "y": 160,
        "wires": [
            [
                "41fb4523.00becc"
            ],
            [
                "86393fb4.c8342"
            ],
            [
                "5cb79342.dd7d1c"
            ],
            [
                "e2b0e06c.1d6c"
            ],
            [
                "f8b5c537.a5adb8"
            ]
        ]
    },
    {
        "id": "f8b5c537.a5adb8",
        "type": "websocket out",
        "z": "8cc8cd00.37ee",
        "name": "",
        "server": "32f33346.bc3b9c",
        "client": "",
        "x": 560,
        "y": 280,
        "wires": []
    },
    {
        "id": "41fb4523.00becc",
        "type": "rpi-gpio out",
        "z": "8cc8cd00.37ee",
        "name": "",
        "pin": "35",
        "set": true,
        "level": "0",
        "freq": "",
        "out": "out",
        "x": 540,
        "y": 40,
        "wires": []
    },
    {
        "id": "5cb79342.dd7d1c",
        "type": "rpi-gpio out",
        "z": "8cc8cd00.37ee",
        "name": "",
        "pin": "38",
        "set": true,
        "level": "0",
        "freq": "",
        "out": "out",
        "x": 560,
        "y": 160,
        "wires": []
    },
    {
        "id": "86393fb4.c8342",
        "type": "rpi-gpio out",
        "z": "8cc8cd00.37ee",
        "name": "",
        "pin": "37",
        "set": true,
        "level": "0",
        "freq": "",
        "out": "out",
        "x": 580,
        "y": 100,
        "wires": []
    },
    {
        "id": "e2b0e06c.1d6c",
        "type": "rpi-gpio out",
        "z": "8cc8cd00.37ee",
        "name": "",
        "pin": "36",
        "set": true,
        "level": "0",
        "freq": "",
        "out": "out",
        "x": 580,
        "y": 220,
        "wires": []
    },
    {
        "id": "32f33346.bc3b9c",
        "type": "websocket-listener",
        "z": "8cc8cd00.37ee",
        "path": "/ws/picar",
        "wholemsg": "false"
    }
    ]</code></pre>
                  </div>
                  <div class="nodered-screen">
                    <img src="../img/picar-control-flow.png" />
                  </div>
                  <p>
                      Note the pins use for controling the car.
                      Top to bottom they are: 35-forward, 37-reverse, 38-left, 36-right.
                      Use the pins when connecting the Pi to the RC car receiver (more on that).
                  </p>
  
                  <p>
                      Paste the folloing into a new flow. 
                      This flow will allow the creation of username &amp; password combinations with the secret key.
                  </p>
  
                  <p>
                    <h3>PiCar Driver</h3>
                  </p>
  
                  <div class="btn-group btn-group-code" role="group">
                    <button id="show-picar-driver-flow-code" type="button" class="btn btn-info" data-toggle="collapse" data-target="#picar-driver-flow">Show Code</button>
                    <button id="copy-picar-driver-flow-code" type="button" class="btn btn-info">Copy Code</button>
                  </div>
  
                  <div id="picar-driver-flow" class="collapse">
                    <pre><code class="json driver-code">  [
  {
      "id": "78b167b4.a9f548",
      "type": "function",
      "z": "e536286d.022a58",
      "name": "Get Submitted",
      "func": "msg.driver= msg.payload.driver;\nvar keyobject = {};\nkeyobject[msg.driver] = msg.payload.key;\nmsg.payload = JSON.stringify(keyobject);\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 180,
      "y": 100,
      "wires": [
          [
              "16f254da.af2e9b"
          ]
      ]
  },
  {
      "id": "abdf6535.c50fa8",
      "type": "function",
      "z": "e536286d.022a58",
      "name": "Save Cred",
      "func": "var driver = msg.driver;\nvar key = msg.key;\n\nvar keyring = msg.payload || {};\nkeyring[driver] = key;\n\nmsg.payload = JSON.stringify(keyring);\nreturn msg;",
      "outputs": "1",
      "noerr": 0,
      "x": 170,
      "y": 380,
      "wires": [
          [
              "1c3a89fe.3c8ea6"
          ]
      ]
  },
  {
      "id": "1c3a89fe.3c8ea6",
      "type": "file",
      "z": "e536286d.022a58",
      "name": "Put keys",
      "filename": "/home/pi/.picar/www/keys",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "true",
      "x": 160,
      "y": 420,
      "wires": []
  },
  {
      "id": "446b2f1.a7503d",
      "type": "file in",
      "z": "e536286d.022a58",
      "name": "Get keys",
      "filename": "/home/pi/.picar/www/keys",
      "format": "utf8",
      "sendError": true,
      "x": 160,
      "y": 300,
      "wires": [
          [
              "b7a6615f.8451c"
          ]
      ]
  },
  {
      "id": "b7a6615f.8451c",
      "type": "json",
      "z": "e536286d.022a58",
      "name": "",
      "x": 150,
      "y": 340,
      "wires": [
          [
              "abdf6535.c50fa8"
          ]
      ]
  },
  {
      "id": "8506b8c2.b64d08",
      "type": "inject",
      "z": "e536286d.022a58",
      "name": "New Driver",
      "topic": "",
      "payload": "{\"driver\":\"\",\"key\":\"\"}",
      "payloadType": "json",
      "repeat": "",
      "crontab": "",
      "once": false,
      "x": 160,
      "y": 60,
      "wires": [
          [
              "78b167b4.a9f548"
          ]
      ]
  },
  {
      "id": "d1f7af12.d2379",
      "type": "function",
      "z": "e536286d.022a58",
      "name": "Get Cred",
      "func": "msg.key = msg.payload;\nreturn msg;",
      "outputs": 1,
      "noerr": 0,
      "x": 160,
      "y": 180,
      "wires": [
          [
              "b1af3d39.bc287"
          ]
      ]
  },
  {
      "id": "b1af3d39.bc287",
      "type": "file-exists",
      "z": "e536286d.022a58",
      "name": "Check keys",
      "filename": "/home/pi/.picar/www/keys",
      "x": 170,
      "y": 220,
      "wires": [
          [
              "4d81c141.92f8e"
          ]
      ]
  },
  {
      "id": "4d81c141.92f8e",
      "type": "function",
      "z": "e536286d.022a58",
      "name": "keys Exists",
      "func": "if(!msg.payload){\n    return [{payload:'{}'}, null]\n}\nreturn [null, msg];",
      "outputs": "2",
      "noerr": 0,
      "x": 170,
      "y": 260,
      "wires": [
          [
              "2acfe82d.167398"
          ],
          [
              "446b2f1.a7503d"
          ]
      ]
  },
  {
      "id": "2acfe82d.167398",
      "type": "file",
      "z": "e536286d.022a58",
      "name": "Make keys",
      "filename": "/home/pi/.picar/www/keys",
      "appendNewline": true,
      "createDir": false,
      "overwriteFile": "false",
      "x": 360,
      "y": 260,
      "wires": []
  },
  {
      "id": "16f254da.af2e9b",
      "type": "hmac",
      "z": "e536286d.022a58",
      "name": "",
      "algorithm": "HmacSHA512",
      "key": "The-same-secret-key-from-the-auth-flow",
      "x": 150,
      "y": 140,
      "wires": [
          [
              "d1f7af12.d2379"
          ]
      ]
  }
  ]</code></pre>
                  </div>
                  <div class="nodered-screen">
                    <img src="../img/picar-driver-flow.png" />
                  </div>
                  <p>
                    Again open the hmac node by double clicking it.
                    Enter the same secret key you used in the Auth flow.
                  </p>
  
                  <p>
                    To create a new driver from this screen edit the New Driver node by double clicking it.
                    Edit the Payload with the desired credentials:
                    <pre><code class="json">  {"driver":"[user name]", "key":"[password]"}</code></pre>
                  </p>
                  <p>
                    Click <code class="no-highlight">Done</code> and then <code class="no-highlight">Deploy</code>.
                    Once the flow is deployed click the box on the right of the New Driver node to inject the credentials.
                    The username and a hash of the password will be added to the "keys" file.
                    You can now log into the page with those credentials.
                    Any additional times this is done adds a new user.
                    If a username is reused it should update that user.
                    To delete a user open the "keys" file in <code class="no-highlight">/home/pi/.picar/www/</code>
                    and delete that entry. I hope to come up with a better solution for that in the future.
                  </p>
                  <h4>View the results</h4>
                  <p>
                    Point a browser to the root of the Pi's webserver.
                    If everything has gone according to the plan the PiCar webpage should be visible.
                    There will be no video for the webcam because that has not been setup.
                    If the direction buttons are pressed the Pi should respond by updating the direction text.
                  </p>
                  <hr>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
  
      <section class="guide" id="three">
          <div class="container">
            <div class="row">
            <div class="col-md-8 mx-auto">
                <h2 class="section-heading text-center">Mjpg-Streamer</h2>
                <div class="text-center">
                    <a href="https://sourceforge.net/projects/mjpg-streamer/"><h4 style="color: rgb(199, 9, 9);">MJPG-Streamer</h4></a>
                </div>
                <div class="row">
                  <div class="col-md-12 mx-auto">
                    <p>
                        Please check back later.
                    </p>
                  </div>
                </div>
            </div>
            </div>
          </div>
        </section>
    
    <footer>
      <div class="container">
        <p>&copy; 2017 Jackson 2012. All Rights Reserved.</p>
        <ul class="list-inline">
          <li class="list-inline-item">
            <!--<a href="#">Privacy</a>-->
          </li>
          <li class="list-inline-item">
            <!--<a href="#">Terms</a>-->
          </li>
          <li class="list-inline-item">
            <!--<a href="#">FAQ</a>-->
          </li>
        </ul>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="../vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for this template -->
    <script src="../js/jackson2012.js"></script>
    <script src="../js/picar.js"></script>

  </body>

</html>
